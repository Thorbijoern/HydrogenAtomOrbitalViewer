<!doctype html>
<html>

<head>
    <meta charset=utf-8>
    <title>Generates view of atomic orbital </title>
    <link rel='stylesheet prefetch' href='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0-alpha.6/css/bootstrap.min.css'>
    <link href="https://fonts.googleapis.com/css?family=Bubbler+One|Source+Sans+Pro:600" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Zilla+Slab" rel="stylesheet">
    <link rel="stylesheet" href="css/hydrogen.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
    <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
    </script>
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({ TeX: { extensions: ["AMSmath.js", "AMSsymbols.js","autobold.js"] }});
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r76/three.min.js"></script>
    <script type="x-shader/x-vertex" id="vertexshader">
        attribute float alpha; varying float vAlpha; attribute float size; attribute vec3 customColor; varying vec3 vColor; void main() { vAlpha = alpha; vColor = customColor; vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 ); gl_PointSize = size* ( 300.0 / -mvPosition.z ); gl_Position = projectionMatrix * mvPosition; }
    </script>
    <script type="x-shader/x-fragment" id="fragmentshader">
        varying float vAlpha; uniform vec3 color; varying vec3 vColor; void main() { gl_FragColor = vec4( color * vColor, vAlpha ); }
    </script>
    <script>
    //Manipulate UI
    function changel() {
        console.log("works");
        $("#l").html("");
        var n = $("#n").val();
        for (i = 0; i < n; i++) {
            $("#l").append("<option value = '" + i + "'>l=" + i + "</option>");
        }
        changem();
    }

    function changem() {
        $("#m").html("");
        var l = $("#l").val();
        for (i = -l; i <= l; i++) {
            if (i < 0) {
                $("#m").append("<option value = 'Neg" + Math.abs(i) + "' selected>m=" + i + "</option>");
            } else if (i == 0) {
                $("#m").append("<option value = '" + i + "' selected>m=" + i + "</option>");
            } else {
                $("#m").append("<option value = 'Pos" + i + "'>m=" + i + "</option>");
            }
        }
    }
    </script>
</head>

<body style="background:white">
    <svg id="circular-menu" class="Absolute Center">
        <defs>
            <filter id="f1" x="0" y="0" width="200%" height="200%">
                <feOffset result="offOut" in="SourceGraphic" dx="0" dy="0" />
                <feColorMatrix result="matrixOut" in="offOut" type="matrix" values="0.2 0 0 0 0 0 0.2 0 0 0 0 0 0.2 0 0 0 0 0 0.5 0" />
                <feGaussianBlur result="blurOut" in="matrixOut" stdDeviation="5" />
                <feBlend in="SourceGraphic" in2="blurOut" mode="normal" />
            </filter>
        </defs>
        <g filter="url(#f1)">
            <a href="#">
                <path id="elem1" d="M 40 0
           L 60 0
           A 60 60 0 0 1 29.088577214780226 52.47718242836375
           L 19 35
           A 40 40 0 0 0 40 0" fill="#A9B0B7" class="radial-element" />
            </a>
            <a href="HydrogenOrbital.html" alt="lol">
                <path id="elem2" d="M 40 0
           L 60 0
           A 60 60 0 0 1 29.088577214780226 52.47718242836375
           L 19 35
           A 40 40 0 0 0 40 0" transform="translate(100) rotate(60)" fill="#AC2B37" class="radial-element" />
            </a>
            <a href="#">
                <path id="elem3" d="M 40 0
           L 60 0
           A 60 60 0 0 1 29.088577214780226 52.47718242836375
           L 19 35
           A 40 40 0 0 0 40 0" fill="#A9B0B7" class="radial-element" />
            </a>
        </g>
    </svg>
    <div class="container-fluid">
        <div class="row" style='height:400px; background-position: 50% 50%; background-size: 50% 100; background-color:gray; background-image: url("http://www.clker.com/cliparts/b/8/c/0/12065573891491312817IncessantBlabber_Stylized_atom.svg");background-repeat:no-repeat;'>
        <div class="col-lg-3">     	
        </div>
            <div class="col-lg-6" style="padding-top: 150px">
                <h1 class="blend-title" align="center"> The Hydrogen Atom</h1>
            </div>
            <div class="col-lg-3">     	
        </div>
        </div>
        <div class="row">
            <div class="col-lg-2">
                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/2e/Erwin_Schr%C3%B6dinger_%281933%29.jpg/220px-Erwin_Schr%C3%B6dinger_%281933%29.jpg" class="rounded-circle" style="height:200px">
            </div>
            <div class="col-lg-10">
                <h2 align="right">Schrodinger Equation</h2>
                <h3 align="right">$$\hat{H}\,\lvert\psi\rangle=\hat{E}\,\lvert\psi\rangle$$</h3>
            </div>
        </div>
        <div class="row" style="background-color:black">
            <div id="model-container" class="col-lg-8"></div>
            <div class="col-lg-4">
                <div class="row">
                    <p id="equation">$$\psi(r,\theta,\phi)= \frac{1}{\sqrt{\pi}\,{a_0}^\frac{3}{2}}\,e^{\frac{-r}{a_0}}$$</p>
                </div>
                <div class="row">
                    <div class="col-lg-3">
                        <p style="text-align: center">Controls</p>
                        <div class="row">
                            <select class="form-control" id="n" onchange='changel()'>
                                <option value='1' selected>n=1</option>
                                <option value='2'>n=2</option>
                                <option value='3'>n=3</option>
                                <option value='4'>n=4</option>
                            </select>
                        </div>
                        <div class="row">
                            <select class="form-control" id="l" onchange='changem()'>
                                <option value='0'>l=0</option>
                            </select>
                        </div>
                        <div class="row">
                            <select class="form-control" id="m">
                                <option value='0'>m=0</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-lg-3">
                        <div class="row">
                            <button type="button" onclick="reload()">Load Orbital</button>
                        </div>
                        <div class="row">
                            <p style="font-size:12pt;font-family:Arial;text-align:center">y-axis scale</p>
                        </div>
                        <div class="row">
                            <input type="range" id="chart-slider" name="Resolution" min="0" max="20" onchange="reloadChart();">
                        </div>
                        <div class="row">
                            <canvas id="myChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class='row' style="background-color:black">
            <div class='col-md-2'>
                <p style="font-size:12pt;">Instructions: </p>
            </div>
            <div class='col-md-3'>
                <p style="font-size:10pt; font-family:Arial">*Use the Mouse wheel to zoom</p>
                <p style="font-size:10pt;font-family:Arial">*Click and drag to rotate orbital</p>
                <p style="font-size:10pt;font-family:Arial">*Select quantum numbers in Controls and click 'Load Orbital' to load new orbitals</p>
                <p style="font-size:10pt;font-family:Arial">*The slider controls the scale of the y-axis in the plot of the radial compnent of the wave function</p>
            </div>
        </div>
    </div>
    <script src="js/OrbitControls.js"></script>
    <script src="js/WaveFunction.js"></script>
    <script type="text/javascript" src="js/Graph.js"></script>
    <script>
    function cubePos1(posArr) { //Creates float arr vertices
        var positions = new Float32Array(posArr.length * 3);
        for (i = 0; i < posArr.length; i++) {
            positions[3 * i] = (posArr[i][0]);
            positions[3 * i + 1] = (posArr[i][1]);
            positions[3 * i + 2] = (posArr[i][2]);
        }
        return positions;
    }

    function cubeCol(posArr) {
        var colors = new Float32Array(posArr.length * 3);
        for (i = 0; i < posArr.length; i++) {
            var color = new THREE.Color(posArr[i][4]);
            colors[3 * i] = color.r;
            colors[3 * i + 1] = color.g;
            colors[3 * i + 2] = color.b;
        }
        return colors;
    }

    function cubeAlpha(posArr) {
        var alphas = new Float32Array(posArr.length);
        max = 0;
        for (i = 0; i < posArr.length; i++) {
            var temp = posArr[i][3];
            if (temp > max)
                max = temp;
            alphas[i] = temp;
        }
        if (l > 0)
            return alphas.map(e => e / (5 * parseInt(l) * max));
        return alphas.map(e => e / (2 * max));
    }

    function cubePos(posArr) { //Creates THREE vector from array of vectors
        var cubeVec = [];
        for (i = 0; i < posArr.length; i++) {
            cubeVec.push([new THREE.Vector3(posArr[i][0], posArr[i][1], posArr[i][2]), posArr[i][3], posArr[i][4]]);
        }
        return cubeVec;
    }

    function cubeSize(resolution, posArr) {
        var sizes = new Float32Array(posArr.length);
        for (var i = 0; i < posArr.length; i++) {
            sizes[i] = 2.5 * range / resolution;
        }
        return sizes;
    }
    var modelContainer = document.getElementById("model-container");
    modelContainer.style.width = 0.65 * window.innerWidth + 'px';
    modelContainer.style.height = 0.60 * window.innerHeight + 'px';

    var scene = new THREE.Scene();
    var camera = new THREE.PerspectiveCamera(75, modelContainer.offsetWidth / modelContainer.offsetHeight, 0.1, 1000);
    var renderer = new THREE.WebGLRenderer();
    renderer.setSize(modelContainer.offsetWidth - 5, modelContainer.offsetHeight - 5);
    modelContainer.appendChild(renderer.domElement);
    console.log(renderer.domElement)


    uniforms = {
        color: { type: "c", value: new THREE.Color(0xffffff) }
    };
    var shaderMaterial = new THREE.ShaderMaterial({
        uniforms: uniforms,
        vertexShader: document.getElementById('vertexshader').textContent,
        fragmentShader: document.getElementById('fragmentshader').textContent,
        blending: THREE.AdditiveBlending,
        depthTest: false,
        transparent: true
    });




    var light = new THREE.PointLight(0xffffff);
    light.position.copy(new THREE.Vector3(0, 0, 30));
    scene.add(light);

    var resolution = 42;
    var range = 3;
    var n = 1;
    var l = 0;
    var cameraOffset = 9;
    camera.position.z = cameraOffset;
    camera.position.x = 0;
    camera.position.y = 0;
    var posArr = simpsonIntegrate(n1l0m0, -range, range, -range, range, -range, range, resolution);

    var geometry = new THREE.BufferGeometry();


    geometry.addAttribute('size', new THREE.BufferAttribute(cubeSize(resolution, posArr), 1));
    geometry.addAttribute('position', new THREE.BufferAttribute(cubePos1(posArr), 3));
    geometry.addAttribute('customColor', new THREE.BufferAttribute(cubeCol(posArr), 3));
    geometry.addAttribute('alpha', new THREE.BufferAttribute(cubeAlpha(posArr), 1));

    var particleSystem = new THREE.Points(
        geometry, shaderMaterial);


    scene.add(particleSystem);
    var nucleus = new THREE.Mesh(new THREE.SphereGeometry(0.1, 10, 10), new THREE.MeshBasicMaterial({ color: 0xffff00, transparent: true }));

    scene.add(nucleus);


    controls = new THREE.OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.dampingFactor = 0.25;
    controls.enableZoom = true;
    controls.enabePan = false;


    window.addEventListener('resize', onResize, false);

    function onResize() {
        modelContainer.style.height = 0.60 * window.innerHeight + 'px';
        modelContainer.style.width = 0.65 * window.innerWidth + 'px';
        camera.aspect = modelContainer.offsetWidth / modelContainer.offsetHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(modelContainer.offsetWidth - 5, modelContainer.offsetHeight - 5);
        render();
    }

    function animate() {
        requestAnimationFrame(animate);
        controls.update();
        light.position.copy(camera.position);
        render();
    }

    function render() {
        renderer.render(scene, camera);
    }
    animate();

    function reload() {
        console.log("works");
        n = $("#n option:selected").val();
        l = $("#l option:selected").val();

        cameraOffset = 5 + 4 * Math.pow(n, 2) - l;

        var waveFunc = "n" + n + "l" + l + "m" + $("#m option:selected").val();

        $('#equation').html("$$\\psi(r,\\theta,\\phi)=" + eval('w' + waveFunc) + "$$");
        MathJax.Hub.Queue(["Typeset", MathJax.Hub, "equation"]);
        range = 1 + 2 * Math.pow(n, 2) + 13 * l
        resolution = 40 + 6 * n + 3 * l;


        var posArr = simpsonIntegrate(eval(waveFunc), -range, range, -range, range, -range, range, resolution);

        geometry.addAttribute('size', new THREE.BufferAttribute(cubeSize(resolution, posArr), 1));
        geometry.addAttribute('position', new THREE.BufferAttribute(cubePos1(posArr), 3));
        geometry.addAttribute('customColor', new THREE.BufferAttribute(cubeCol(posArr), 3));
        geometry.addAttribute('alpha', new THREE.BufferAttribute(cubeAlpha(posArr), 1));

        var particleSystem = new THREE.Points(
            geometry, shaderMaterial);
        camera.position.z = cameraOffset;
        camera.position.x = 0;
        camera.position.y = 0;

        reloadChart();
    }

    function reloadChart() {
        $("#myChart").get(0).getContext("2d").clearRect(0, 0, 300, 200);
        myGraph = new Graph({
            canvasId: 'myChart',
            minX: 0,
            minY: -11,
            maxX: range,
            maxY: 11, //$('chart-slider').val(),
            unitsPerTick: 1
        });
        myGraph.drawEquation(eval('r' + n + l), 'red', 2);
    }
    //controls graph


    var myGraph = new Graph({
        canvasId: 'myChart',
        minX: 0,
        minY: -2,
        maxX: range,
        maxY: 2,
        unitsPerTick: 1
    });
    myGraph.drawEquation(r10, 'red', 2);
    </script>
</body>

</html>